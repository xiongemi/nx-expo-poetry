(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{180:function(e,t,r){e.exports=r(223)},223:function(e,t,r){"use strict";r.r(t);var n=r(238),o=r(5),a=r.n(o),c=r(234),i=r(46),s=r.n(i),u=r(7),l=r.n(u);function d(e){return{title:e.title,author:e.author,lines:e.lines,lineCount:parseInt(e.linecount,10)}}var f=r(115),j="https://poetrydb.org/";function b(){return(b=s()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(j+"random",{method:"GET"});case 2:if(!(t=e.sent).ok){e.next=9;break}return e.next=6,t.json();case 6:if((r=e.sent).status){e.next=9;break}return e.abrupt("return",r);case 9:throw t;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return p.apply(this,arguments)}function p(){return(p=s()(l.a.mark((function e(t,r){var n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!1),e.next=3,fetch(j+"title/"+encodeURIComponent(t)+(r?":abs":""),{method:"GET"});case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:if((o=e.sent).status){e.next=10;break}return e.abrupt("return",o);case 10:throw n;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return m.apply(this,arguments)}function m(){return(m=s()(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(j+"author/"+encodeURIComponent(t)),e.next=3,fetch(j+"author/"+encodeURIComponent(t),{method:"GET"});case 3:if(!(r=e.sent).ok){e.next=10;break}return e.next=7,r.json();case 7:if((n=e.sent).status){e.next=10;break}return e.abrupt("return",n);case 10:throw r;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([h(t).catch((function(){return[]})),O(t).catch((function(){return[]}))]).then((function(e){var r=e[0],n=e[1];return console.log("poems2",n),r.forEach((function(e){return e.similarity=Object(f.compareTwoStrings)(e.title,t)})),n.map((function(e){return e.similarity=Object(f.compareTwoStrings)(e.author,t)})),[].concat(r,n).sort((function(e,t){var r,n;return(null!=(r=t.similarity)?r:0)-(null!=(n=e.similarity)?n:0)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k={getPoemOfTheDay:function(){return b.apply(this,arguments)},getPoemsWithTitle:h,getPoemsWithAuthor:O,searchPoems:function(e){return g.apply(this,arguments)}},v=r(36),y=r(91),x=Object(v.b)("search/fetchStatus",function(){var e=s()(l.a.mark((function e(t,r){var n,o,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchQuery,o=r.rejectWithValue,e.prev=2,console.log("searchQuery",n),e.next=6,k.searchPoems(n);case 6:return a=e.sent,e.abrupt("return",a.map(d));case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",o({error:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r){return e.apply(this,arguments)}}()),S=Object(v.c)(),P=S.getInitialState({loadingStatus:"not loaded",error:void 0}),w=Object(v.d)({name:"search",initialState:P,reducers:{},extraReducers:function(e){e.addCase(x.pending,(function(e){e.loadingStatus="loading"})).addCase(x.fulfilled,(function(e,t){S.setAll(e,t.payload.map((function(e){return{id:encodeURIComponent(e.title),poem:e}}))),e.loadingStatus="loaded"})).addCase(x.rejected,(function(e,t){e.loadingStatus="error",e.error=t.error.message}))}}),D=w.reducer,T=(w.actions,S.getSelectors()),B=T.selectAll,E=T.selectEntities,C=T.selectById,R=function(e){return e.search},I=Object(y.a)(R,B),M=Object(y.a)(R,E),A=Object(y.a)(R,(function(e){return e.loadingStatus})),N={getSearchState:R,selectAllSearchResults:I,selectSearchEntities:M,selectSearchResultById:function(e){return Object(y.a)(R,(function(t){return C(t,e)}))},getLoadingStatus:A},L=Object(v.b)("bookmarks/fetchStatus",function(){var e=s()(l.a.mark((function e(t,r){var n,o,a,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.title,o=t.author,a=r.rejectWithValue,e.prev=2,e.next=5,k.getPoemsWithTitle(n,!0);case 5:if((c=e.sent).length){e.next=8;break}return e.abrupt("return",a({error:"not found"}));case 8:if(!(c.length>1)){e.next=13;break}if(i=c.find((function(e){return e.author===o}))){e.next=12;break}return e.abrupt("return",a({error:"not found"}));case 12:return e.abrupt("return",d(i));case 13:return e.abrupt("return",d(c[0]));case 16:return e.prev=16,e.t0=e.catch(2),e.abrupt("return",a({error:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,r){return e.apply(this,arguments)}}()),z=Object(v.c)(),U=z.getInitialState({loadingStatus:"not loaded",error:void 0}),J=Object(v.d)({name:"bookmarks",initialState:U,reducers:{add:z.addOne,remove:z.removeOne},extraReducers:function(e){e.addCase(L.pending,(function(e){e.loadingStatus="loading"})).addCase(L.fulfilled,(function(e,t){e.poem=t.payload,e.loadingStatus="loaded"})).addCase(L.rejected,(function(e,t){e.loadingStatus="error",e.error=t.error.message}))}}),W=J.reducer,V=J.actions,F=z.getSelectors(),G=F.selectAll,Q=F.selectEntities,q=function(e){return e.bookmarks},H={selectAllBookmarks:Object(y.a)(q,G),selectBookmarksEntities:Object(y.a)(q,Q),getBookmarkPoem:Object(y.a)(q,(function(e){return e.poem}))},K=Object(v.b)("poemOfTheDay/fetchStatus",function(){var e=s()(l.a.mark((function e(t,r){var n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.rejectWithValue,e.prev=1,e.next=4,k.getPoemOfTheDay();case 4:return o=e.sent,e.abrupt("return",d(o[0]));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",n({error:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()),X={loadingStatus:"not loaded",poem:void 0,error:void 0},Y=Object(v.d)({name:"poemOfTheDay",initialState:X,reducers:{},extraReducers:function(e){e.addCase(K.pending,(function(e){e.loadingStatus="loading"})).addCase(K.fulfilled,(function(e,t){e.poem=t.payload,e.loadingStatus="loaded"})).addCase(K.rejected,(function(e,t){e.loadingStatus="error",e.error=t.error.message}))}}),Z=Y.reducer,$=(Y.actions,function(e){return e.poemOfTheDay}),_={getPoemOfTheDayState:$,getPoemOfTheDay:Object(y.a)($,(function(e){return e.poem})),getPoemOfTheDayLoadingStatus:Object(y.a)($,(function(e){return e.loadingStatus}))},ee=(r(132),r(87)),te={poemOfTheDay:X,bookmarks:U,search:P},re=r(35),ne=Object(re.b)({poemOfTheDay:Z,bookmarks:W,search:D}),oe=r(21),ae=r.n(oe),ce=Object(ee.a)((function(e){return ae()({},e,{ids:JSON.stringify(e.ids),entities:JSON.stringify(e.entities)})}),(function(e){return ae()({},e,{ids:JSON.parse(e.ids),entities:JSON.parse(e.entities)})}),{whitelist:["bookmarks"]}),ie=r(0),se=r.n(ie),ue=r(1),le=r(4),de=r(3),fe=function(e){var t=e.children;return Object(de.jsx)(le.a,{style:je.center,children:t})},je=ue.a.create({center:{display:"flex",alignItems:"center",justifyContent:"center"}}),be=fe,he=function(e){var t=e.children;return Object(de.jsx)(le.a,{style:pe.container,children:t})},pe=ue.a.create({container:{flex:1,justifyContent:"space-between"}}),Oe=he,me=r(96),ge=function(e){var t=e.children;return Object(de.jsx)(le.a,{style:ke.spacing,children:t})},ke=ue.a.create({spacing:{margin:10}}),ve=ge;function ye(){return Object(de.jsx)(be,{children:Object(de.jsx)(ve,{children:Object(de.jsx)(me.a,{animating:!0,size:"large",children:void 0})})})}var xe,Se=ye,Pe=r(41),we=r(64),De=r(40),Te=r(80),Be=r(162),Ee=r(63),Ce=r(59),Re=r(104);!function(e){e.PoemOfTheDay="Poem of the Day",e.Bookmarks="Bookmarks",e.Bookmark="Bookmark",e.Search="Search",e.Result="Result"}(xe||(xe={}));var Ie=r(239),Me=r(160);function Ae(e){var t=e.showLoading,r=e.hasError,n=e.reload,o=e.children;return t?Object(de.jsx)(Se,{}):r?Object(de.jsxs)(fe,{children:[Object(de.jsx)(ve,{children:Object(de.jsx)(Ie.a,{size:40,icon:"alert",children:void 0})}),Object(de.jsx)(Ee.a,{children:"Oops~ Something went wrong"}),Object(de.jsx)(Me.a,{children:"Make sure you got internet connection."}),n&&Object(de.jsx)(Ce.a,{onPress:n,mode:"contained",children:"Try Again"})]}):Object(de.jsx)(de.Fragment,{children:o})}var Ne=Ae;function Le(e){var t,r,n,o=e.loadingStatus,a=e.formattedDate,c=e.poem,i=e.bookmark,s=e.fetch,u=e.goToSearch,l=Object(Pe.k)(),d=Object(ie.useState)(!1),f=d[0],j=d[1];return Object(de.jsxs)(Oe,{children:[Object(de.jsx)(we.a,{children:Object(de.jsx)(De.a,{contentInsetAdjustmentBehavior:"automatic",children:Object(de.jsx)(Ne,{showLoading:"not loaded"===o||"loading"===o,hasError:"error"===o,reload:s,children:Object(de.jsxs)(Te.a,{testID:"poem-card",children:[Object(de.jsx)(Te.a.Title,{testID:"poem-card-title",title:null==c?void 0:c.title,subtitle:a}),Object(de.jsx)(Te.a.Cover,{source:{uri:"https://picsum.photos/300/200"}}),Object(de.jsxs)(Te.a.Actions,{children:[Object(de.jsx)(Ce.a,{icon:"heart-outline",onPress:function(){c&&(i(a,c),j(!0))},children:"Bookmark"}),s&&Object(de.jsx)(Ce.a,{icon:"play-skip-forward-outline",onPress:function(){return s()},children:"Next"}),u&&Object(de.jsx)(Ce.a,{icon:"search",onPress:function(){return u("")},children:"Search"})]}),Object(de.jsxs)(Te.a.Content,{children:[Object(de.jsxs)(be,{children:[Object(de.jsx)(Ee.a,{children:null==c?void 0:c.title}),null==c||null==(t=c.author)||null==(r=t.split(","))?void 0:r.map((function(e,t){return Object(de.jsx)(Ce.a,{onPress:function(){return u(e)},children:e},t)}))]}),Object(de.jsx)(Be.a,{children:null==c||null==(n=c.lines)?void 0:n.map((function(e){return e+"\n"}))})]})]})})})}),Object(de.jsx)(Re.a,{visible:f,onDismiss:function(){return j(!1)},duration:5e3,action:{label:"View All",onPress:function(){return l.navigate(xe.Bookmarks)}},children:"Poem bookmarked!"})]})}var ze=r(105),Ue=r(233);function Je(e){var t,r,n=e.poem,o=e.onPress;return n&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)(Ue.a,{title:n.title,descriptionNumberOfLines:3,description:n.author+"\n"+(null==(t=n.lines)?void 0:t[0])+" "+(null==(r=n.lines)?void 0:r[1])+" ...",descriptionEllipsizeMode:"tail",onPress:o}),Object(de.jsx)(ze.a,{})]})}var We=r(173),Ve=r(235),Fe=r(237),Ge=r(53),Qe=r(70),qe=r(172),He=r(43),Ke=r(164),Xe=r(236);function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $e=Object(He.b)((function(e){return{poem:H.getBookmarkPoem(e)}}),(function(e){return{fetchBookmark:function(t,r){e(L({title:t,author:r}))},bookmark:function(t,r){e(V.add({formattedDate:t,id:encodeURIComponent(r.title),poem:Ze(Ze({},r),{},{lines:r.lines.slice(0,1)})}))}}}))((function(e){var t,r,n,o=e.poem,a=e.fetchBookmark,c=e.bookmark,i=new Date,s=Object(Pe.k)(),u=Object(Pe.m)(),l=null==(t=u.params)?void 0:t.title,d=null==(r=u.params)?void 0:r.author,f=(null==(n=u.params)?void 0:n.formattedDate)||Object(Xe.a)(i,"MMMM do, yyyy");return Object(ie.useEffect)((function(){l&&a(l,d)}),[l,d,a]),Object(de.jsx)(Le,{loadingStatus:"loaded",formattedDate:f,poem:o,bookmark:c,goToSearch:function(e){return s.navigate(xe.Search,{search:e})}})})),_e=r(9),et=r.n(_e),tt=r(15);var rt=function(e){var t=e.bookmark,r=e.removeBookmark,n=e.onPress;return Object(de.jsx)(Ue.a,{title:t.poem.title,descriptionNumberOfLines:3,description:t.formattedDate+"\n"+t.poem.lines[0]+"...",descriptionEllipsizeMode:"tail",onPress:n,right:function(){return Object(de.jsx)(Qe.a,{size:30,icon:"remove-circle",color:tt.e,onPress:function(){return r(t)}})}})};var nt=Object(He.b)((function(e){return{bookmarks:H.selectAllBookmarks(e)}}),(function(e){return{removeBookmark:function(t){e(V.remove(t.id))},addBookmark:function(t){e(V.add(t))}}}))((function(e){var t,r=e.bookmarks,n=e.removeBookmark,o=e.addBookmark,a=Object(Pe.k)(),c=Object(ie.useState)(!1),i=et()(c,2),s=i[0],u=i[1],l=Object(ie.useState)(),d=et()(l,2),f=d[0],j=d[1],b=function(e){n(e),j(e),u(!0)};return Object(de.jsxs)(he,{children:[Object(de.jsx)(we.a,{children:Object(de.jsx)(De.a,{contentInsetAdjustmentBehavior:"automatic",children:r&&null!=r&&r.length?r.map((function(e){return e&&e.poem&&Object(de.jsxs)(le.a,{children:[Object(de.jsx)(rt,{bookmark:e,removeBookmark:b,onPress:function(){return a.navigate(xe.Bookmark,{formattedDate:e.formattedDate,title:e.poem.title,author:e.poem.author})}}),Object(de.jsx)(ze.a,{})]},e.id)})):Object(de.jsxs)(fe,{children:[Object(de.jsx)(ge,{children:Object(de.jsx)(Ie.a,{size:40,icon:"book",children:void 0})}),Object(de.jsx)(ge,{children:Object(de.jsx)(Ee.a,{children:"No poems bookmarked~"})})]})})}),Object(de.jsxs)(Re.a,{visible:s,onDismiss:function(){return u(!1)},action:{label:"Undo",onPress:function(){f&&o(f)}},children:["Remove ",null==f||null==(t=f.poem)?void 0:t.title]})]})}));function ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ct=Object(He.b)((function(e){return{poem:_.getPoemOfTheDay(e),loadingStatus:_.getPoemOfTheDayLoadingStatus(e)}}),(function(e){return{fetchPoemOfTheDay:function(){e(K())},bookmark:function(t,r){e(V.add({formattedDate:t,id:encodeURIComponent(r.title),poem:at(at({},r),{},{lines:r.lines.slice(0,1)})}))}}}))((function(e){var t=e.poem,r=e.fetchPoemOfTheDay,n=e.bookmark,o=e.loadingStatus,a=new Date,c=Object(Xe.a)(a,"MMMM do, yyyy"),i=Object(Pe.k)();return Object(ie.useEffect)((function(){r()}),[r]),Object(de.jsx)(Le,{fetch:r,loadingStatus:o,formattedDate:c,poem:t,bookmark:n,goToSearch:function(e){return i.navigate(xe.Search,{search:e})}})}));function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function st(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ut=Object(He.b)((function(e){return{searchResultById:function(t){return N.selectSearchResultById(t)(e)}}}),(function(e){return{bookmark:function(t,r){e(V.add({formattedDate:t,id:encodeURIComponent(r.title),poem:st(st({},r),{},{lines:r.lines.slice(0,1)})}))}}}))((function(e){var t,r=e.searchResultById,n=e.bookmark,o=new Date,a=Object(ie.useState)(),c=et()(a,2),i=c[0],s=c[1],u=Object(Pe.k)(),l=null==(t=Object(Pe.m)().params)?void 0:t.id,d=Object(Xe.a)(o,"MMMM do, yyyy");return Object(ie.useEffect)((function(){var e;l&&s(null==(e=r(l))?void 0:e.poem)}),[l,r]),Object(de.jsx)(Le,{loadingStatus:"loaded",formattedDate:d,poem:i,bookmark:n,goToSearch:function(e){return u.navigate(xe.Search,{search:e})}})})),lt=r(175);var dt=Object(He.b)((function(e){return{searchEntities:N.selectAllSearchResults(e),loadingStatus:N.getLoadingStatus(e)}}),(function(e){return{fetchSearch:function(t){e(x({searchQuery:t}))}}}))((function(e){var t,r=e.searchEntities,n=e.loadingStatus,o=e.fetchSearch,a=Object(Pe.k)(),c=null==(t=Object(Pe.m)().params)?void 0:t.search,i=se.a.useState(""),s=et()(i,2),u=s[0],l=s[1];Object(ie.useEffect)((function(){c&&c.length&&(l(c),o(c))}),[o,c]);var d=function(e){l(e),e&&e.length>3&&o(e)};return Object(de.jsx)(we.a,{children:Object(de.jsxs)(De.a,{contentInsetAdjustmentBehavior:"automatic",children:[Object(de.jsx)(lt.a,{placeholder:"Search any poem title or author",onChangeText:d,value:u,children:void 0,autoComplete:void 0,icon:"search",clearIcon:"close"}),Object(de.jsx)(Ae,{showLoading:"loading"===n,hasError:"error"===n,reload:function(){return d(u)},children:u&&u.length>3?r&&r.length?r.map((function(e){return Object(de.jsx)(Je,{poem:e.poem,onPress:function(){return a.navigate(xe.Result,{id:e.id})}},e.id)})):Object(de.jsxs)(fe,{children:[Object(de.jsx)(ge,{children:Object(de.jsx)(Ie.a,{size:40,icon:"alert",children:void 0})}),Object(de.jsx)(Ee.a,{children:"Nothing found~"})]}):Object(de.jsx)(de.Fragment,{})})]})})}));function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var bt=function(){var e=function(e){var t=ne,r=Object(ee.b)(e,t),n=Object(v.a)({reducer:r,middleware:function(e){var t=e({serializableCheck:!1});return t},devTools:!1,preloadedState:te});return{store:n,persistor:Object(ee.c)(n)}}({key:"root",storage:We.a,whitelist:["bookmarks"],transforms:[ce]}),t=e.store,r=e.persistor,n=jt(jt({},Ge.a),{},{roundness:2,colors:jt(jt({},Ge.a.colors),{},{primary:"#855913",accent:"#aec5c5"})}),o=Object(Fe.a)();return Object(de.jsx)(qe.a,{theme:n,settings:{icon:function(e){return Object(de.jsx)(c.a,jt({},e))}},children:Object(de.jsx)(Ke.a,{loading:Object(de.jsx)(ye,{}),persistor:r,children:Object(de.jsx)(He.a,{store:t,children:Object(de.jsx)(Ve.a,{children:Object(de.jsxs)(o.Navigator,{initialRouteName:xe.PoemOfTheDay,children:[Object(de.jsx)(o.Screen,{name:xe.PoemOfTheDay,component:ct,options:function(e){var t=e.navigation;return{headerRight:function(){return Object(de.jsx)(Qe.a,{icon:"book",onPress:function(){return t.navigate(xe.Bookmarks)}})}}}}),Object(de.jsx)(o.Screen,{name:xe.Bookmarks,component:nt}),Object(de.jsx)(o.Screen,{name:xe.Search,component:dt}),Object(de.jsx)(o.Screen,{name:xe.Result,component:ut}),Object(de.jsx)(o.Screen,{name:xe.Bookmark,component:$e})]})})})})})};Object(n.a)(bt)}},[[180,1,2]]]);
//# sourceMappingURL=app.d7be7c39.chunk.js.map